<%
   js_bundle :course_comments
   js_env :review_course_id =>  @context.id
%>
<style>
    .course_properties{
        display: inline;
        margin-left: 33px;

    }
    .price_box{
        float: right;
        margin-top: -190px;
        width: 20.5%;
        margin-right: 60px;
        background-color: white;
        height: 178px;
        text-align: center;
    }

    .xouter3{
    margin-top: 10px;
    }
    .xleftcol3{
        float: left;
        width: 21%;
        margin-left: 59px;
    }
    .xmiddlecol3 {
        overflow:hidden;

    }
    * html .xmiddlecol3{float:left}
    * html .xmiddlecol3 .xinner3{width:100%;}

    .xrightcol3 {
        float: right;
        width: 21.3%;
        position: relative;
        margin-left: 55px;
        margin-right: 59px;
    }
   .xinner3{margin-left: 30px;
   }
   .course_module_item{
       padding: 14px;
       background: #f6f5ed;
       box-shadow: 0 1px 2px rgba(0,0,0,0.2);
       margin-bottom: 6px;
       list-style: none;
   }
    .course_module_item:hover{
        border-left: 3px solid #008fd6;
    }
    .default_hover_style{
        border-left: 3px solid #008fd6;
    }
    .left{
        float: left;
    }
    .instructor-bio-content{
        margin-left: 21px;
        margin-right: 5px;
    }
    .instructor-bio:hover {
        -moz-box-shadow: 0 0 10px #ccc;
        -webkit-box-shadow: 0 0 10px #ccc;
        box-shadow: 0 0 10px #ccc;
    }
    .comment_box:hover{
        -moz-box-shadow: 0 0 10px #ccc;
        -webkit-box-shadow: 0 0 10px #ccc;
        box-shadow: 0 0 10px #ccc;
    }
   .comment{
       padding: 17px;
       margin-bottom: 10px;
       background: #f6f5ed;
       box-shadow: 0 1px 2px rgba(0,0,0,0.2);
   }
    .left_bottom_border{
        order-bottom: 1px solid lightgray;
        border-left: 1px solid lightgray;
        border-radius: 3px;
    }
   .price_box_on_model{
       text-align: center;
       width: 300px;
       height: 70px;
       margin-left: 128px;
   }
   .pop_up_h3{
      color: #994b2c;
      float: none;
      font-size: 18px;
      text-align: center;
      line-height: 30px;
      margin-top: -12px;
      margin-bottom: 40px;
    }
    .pop_up_close{
       float: right;
       margin-top: -44px;
       margin-bottom: 28px;
    }
     .fancybox-inner{
         padding: 0;
         margin: 0;
         border: 0;
         outline: 0;
         vertical-align: top;
         position: relative;
         overflow: visible!important;
         background: #fff;
     }
      .user_details{
          margin: -25px 15px 15px;

      }
      .left-col{
          float: left;
          position: relative;
          border: 1px solid #666;
          overflow: hidden;
          box-shadow: 0 3px 11px rgba(211, 47, 47, 0.45);
          width: 50px;
          border-radius: 500px;
      }
      .right-col{
          font-family: georgia;
          font-size: 13px;
          font-style: italic;
          margin-left: 60px;
          margin-top: 2px
      }
        .rating-line{
            content: '';
            width: 108%;
            height: 1px;
            background: #e5e5e5;
            left: 0;
            top: 50%;
            margin-left: -40px;
        }
        .article{
            margin: 16px 15px 4px;
            color: #555;
            padding: 20px;
            background: lemonchiffon;
            width: 102%;
            margin-left: -38px;
            margin-top: -13px;
            margin-bottom: 0px;
        }
        .pop_up_li{
            margin-bottom: 37px;
        }
        .user_name{
            color: #567c1b;
            font-family: helvetica;
            font-style: normal;
            cursor: pointer
        }
        .time{
            font-size: 11px;
            color: #777;
            font-style: normal;
            padding:4px;
        }

</style>
<% @body_classes << "gradebook2 full-width"
@show_left_side = false
%>
<div
<% if @context_bg_image_url %>
    style="background-image: url('<%= @context_bg_image_url %>');background-size: 100% auto;height: 250px;"
<% else  %>
    style="background: #f6f5ed;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);;height: 250px;"
<% end  %>
>
  <div style="width: 20%;padding-top: 19px;padding-left: 60px;">
    <% if @context_image_url  %>
        <%= image_tag @context_image_url ,:class=> "thumbnail" ,:style => "width: 275px;height: 181px;"%>
    <% else %>
        <div style="width: 280px;height: 207px;"></div>
    <% end %>
  </div>
<div style="width: 72.5%;float: right;margin-top: -185px;">
  <div style="width: 600px;font-size: 23px;
          font-weight: bold;">
        <%= @context.name %>
  </div>

  <div style="width: 580px;font-size: 16px;">
    <br/>
    <p>
     <%= @context.course_description.try(:short_description) %>
    </p>
  </div>

  <div style="margin-top: 53px;">
    <ul>
      <li class="course_properties">
       <%= image_tag 'comments.png',:style=>"margin-top: -2px;" %>  <%= pluralize(@context.comments.size,"Review") %>
      </li>
      <li class="course_properties">
        <%= image_tag 'modules.png',:style=>"margin-top: -2px;" %>  <%= pluralize(@context.context_modules.size,"Module") %>
      </li>
      <li class="course_properties">
        <%= image_tag 'people.png',:style=>"margin-top: -2px;" %> <%= pluralize(@context.students.size,"Student") %> Enrolled
      </li>
    </ul>
  </div>

</div>

  <div class="price_box thumbnail">
    <div style="font-size: 18px;margin-top: 36px;">Cost per enrollment:</div>
    <div style="font-size: 18px;margin-top: 10px;font-weight: bold;
            color: darkgreen;"><%= @course_pricing.nil? ? "Free" : "$#{@course_pricing.price}" %></div>
    <div style="margin-top: 20px;">
     <%if can_do(@context, @current_user, :read)  %>
          <%= link_to "Go to class" ,course_path(@context) ,:class =>"btn btn-primary btn-large" ,:style=> "border-radius: 0px;"%>
     <% else  %>
          <button class="btn btn-primary btn-large element_toggler" aria-controls="enrollment_dialog"  type="button" style="border-radius: 0px;">Take This Course</button>
     <% end  %>
    </div>
  </div>
</div>

<div class="xouter3">
  <div class="xleftcol3">
    <h1>Instructors</h1>
    <% @context.teachers.each do |teacher| %>
    <div class="instructor-bio comment comment_box" style="max-height: none;border-bottom: 1px solid lightgray;border-right: 1px solid lightgray;
            border-radius: 4px;">
      <img src=<%= teacher.avatar_url ? teacher.avatar_url : "http://www.gravatar.com/avatar/00000000000000000000000000000000?d=mm&f=y" %> width="100" height="100" class="left img-circle" alt="<%= teacher.name%>">
      <h3 class="last emboss-light"><%= teacher.name%></h3>
      <p class="fineprint emboss-light"><em style="margin-left: 10px;"><%= teacher.profile.title if  teacher.profile %></em></p>
      <div class="instructor-bio-content">
        <p><%= teacher.profile.bio if  teacher.profile %></p>

      </div>
      <div class="instructor-bio-more" style="display: none;">
        <a href="#" class="prompt-link">More</a>
      </div>
    </div>
        <br/>
    <% end %>

  </div>
  <div class="xrightcol3">
    <h1>Reviews</h1>
    <% @comments.each do |comment| %>

          <div  class="comment left_bottom_border" id="comment_<%= comment ? comment.id : "{{ blank }}" %>" style="<%= hidden unless comment %>">
            <div style="float: left;" class="user_name">

              <% if service_enabled?(:avatars) %>
                  <%= avatar(comment.user_id) %>
              <% end  %>
              <%= comment.user_name rescue nbsp %></div>
            &nbsp;<%= comment.user.name  %>
            <br> &nbsp;

            <span class="created_at" style="color: #888; font-size: 0.8em;">
                  <%= datetime_string(comment.updated_at) rescue nbsp %></span>
            <div class="clear" style="border-top: 1px solid #ccc;"></div>
           <p><%= comment.comment  %></p>
          </div>

    <%end %>
    <% if @context.comments.approved.count > 5 %>
     <% @total_count =   @context.comments.approved.count%>
    <a class="btn btn-primary" id="comments_review" style="margin-left: 20%;border-radius: 0px;margin-bottom: 10px;">
      SEE ALL <%= @total_count%> REVIEWS </a>
     <%end %>
  </div>
  <div class="xmiddlecol3">
    <div class="xinner3">
    <h1 style="border-bottom: 1px solid lightgray;" y>Full course description</h1>
      <div style="font-size: 16px;
              line-height: 1.5;">
        <%= @context.course_description.try(:long_description) %>
      </div>
      <hr/>

      <h1>Course Modules</h1>
      <ul style="margin: 0px;">
        <% @context.context_modules.active.each_with_index do |context_modules, idx |  %>
        <li class="course_module_item <%= idx == 0 ? 'default_hover_style' : "" %> ">
          <%= context_modules.name %>
        </li>
        <% end  %>
      </ul>
    </div>
  </div>
</div>
<div class="clear" style="border-top: 1px solid #ccc;margin-top: 50px;"></div>

<form action="<%=library_enrollments_path(@context)%>" id="enrollment_dialog" data-turn-into-dialog='{"width":600,"height":600,"modal":true}' style="display:none"
      title="<%= @context.name %>">
  <p> You are enrolling in,<b><%= @context.name %> </b> as a student.</p>
  <br/>
  <div class="price_box_on_model thumbnail">
    <div style="font-size: 18px;margin-top: 10px;">Cost per enrollment:</div>
    <div style="font-size: 18px;margin-top: 10px;font-weight: bold;
            color: darkgreen;"><%= @course_pricing.nil? ? "Free" : "$#{@course_pricing.price}" %></div>
  </div>
  <br/>
  <% if @current_user %>
    <p>You are currently signed in as <b><%= @current_user.name %></b>. </p>
   <% else  %>
      <p>Please enter your email address:</p>
   <div id="login_url" style="margin-left: 128px;" rel="<%= login_path(:nonldap => (@domain_root_account && !@domain_root_account.ldap_authentication?).presence) %>">
        <div class="control-group" id="email_info" rel="<%= library_create_user_path(@context) %>">
          <label class="control-label" for="student_email">Email</label>
          <div class="controls">
            <input type="email" id="student_email" name="pseudonym[unique_id]" required="required" >
          </div>
        </div>
        <div class="control-group" id="initial_action">
          <div class="controls">
            <label class="radio">
              <input type="radio" name="initial_action" value="create">
              I am a new user
            </label>
            <label class="radio">
              <input type="radio" name="initial_action" value="log_in">
              I already have a <%=@domain_root_account.name  %> login
            </label>
          </div>
        </div>
        <div class="user_info" id="log_in_user_info" style="display: none;">
          <div class="control-group">
            <label class="control-label" for="student_password">Password</label>
            <div class="controls">
              <input type="password" id="student_password" name="pseudonym[password]" required="required">
            </div>
          </div>
        </div>
        <div class="user_info" id="create_user_info" style="display: none;">
          <div class="control-group">
            <label class="control-label" for="student_name">Full Name</label>
            <div class="controls">
              <input type="text" id="student_name" name="user[name]" required="required">
            </div>
          </div>
          <div class="control-group">
            <div class="controls">
              <label class="checkbox">
                <input id="terms_of_use" type="checkbox" name="user[terms_of_use]" value="1" required="required" >
                You agree to the <a href="<%= @domain_root_account.terms_of_use_url %>" target="_blank" class="external"><span>terms of use</span><span class="ui-icon ui-icon-extlink ui-icon-inline" title="Links to an external site."></span></a> and the <a href="//www.arrivulms.com/code-of-conduct" target="_new">code of conduct</a>.
              </label>
            </div>
          </div>
        </div>
        <div class="control-group embedded-footer">
          <a href="<%= @domain_root_account.privacy_policy_url %>" target="_blank" class="footer-info external"><span>View Privacy Policy</span><span class="ui-icon ui-icon-extlink ui-icon-inline" title="Links to an external site."></span></a>
          <div class="controls">
            <button class="btn btn-primary" style="visibility: hidden" id="submit_button" type="submit">Next</button>
          </div>
        </div>
    </div>
  <% end %>
  <div class="button-container">
    <% if @current_user %>
    <button type="submit" id="course_enrollment" class="btn btn-primary">Enroll in course</button>
    <% end %>
    <a class="btn dialog_closer">cancel</a>
  </div>
</form>
<% js_block do %>
    <script type="text/javascript">
        require([
            'jquery' /* $ */,
            'jquery.instructure_forms' /* formSubmit */,
            'jqueryui/dialog',
            'jquery.disableWhileLoading'
        ], function($) {
            var clicked_create;
            $('input:radio[name="initial_action"]').change(
                    function(){
                        if ($(this).is(':checked') && $(this).val() == 'create') {
                            $("#create_user_info").show();
                            $("#log_in_user_info").hide();
                            clicked_create= 1;
                        }else{
                            $("#create_user_info").hide();
                            $("#log_in_user_info").show();
                            clicked_create= 0;
                        }
                    });
            $("#submit_button").click(function(event) {
                event.preventDefault();
                var $this = $(this);
                if (clicked_create == 1){
//                    validation

                    if ($('#student_email').val() == ""){
                        result = $('#student_email').validateForm({required: ['pseudonym[unique_id]']});
                        return false;
                    }

                    if ($('#student_name').val() == ""){
                        result = $('#student_name').validateForm({required: ['user[name]']});
                        return false;
                    }

                    if (!$('#terms_of_use').is(":checked")){
                        result = $('#terms_of_use').validateForm({required: ['user[terms_of_use]']});
                        return false;
                    }
//                    validation
                    $("#enrollment_dialog").disableWhileLoading($.ajax({
                        type: 'POST',
                        url: $("#email_info").attr('rel'),
                        data: {pseudonym: {unique_id: $("#student_email").val()},user: {name: $("#student_name").val()} },
                        success: function(res){
                            $.flashMessage('User account created successfully!')
                            window.location.href = $("#enrollment_dialog").attr( 'action' );

                        },
                        error: function(res){
                            $.flashMessage('Email already taken!')

                        }
                    })
                    );

                }else if (clicked_create == 0){
                    //                    validation
                    if ($('#student_email').val() == ""){
                        result = $('#student_email').validateForm({required: ['pseudonym[unique_id]']});
                        return false;
                    }

                    if ($('#student_password').val() == ""){
                        result = $('#student_password').validateForm({required: ['pseudonym[password]']});
                        return false;
                    }
//                    validation

                    $("#enrollment_dialog").disableWhileLoading($.ajax({
                        type: 'POST',
                        url: $("#login_url").attr('rel'),
                        data: {pseudonym_session: {unique_id: $("#student_email").val(),password: $("#student_password").val() ,remember_me: 0} },
                        success: function(res){
                            $.flashMessage('You have logged in successfully!')
                            window.location.href = $("#enrollment_dialog").attr( 'action' );

                        },
                        error: function(res){
                            $.flashMessage('Your name password is worong')
                        }
                    })
                    );
                }

            });
        });
    </script>
<% end %>