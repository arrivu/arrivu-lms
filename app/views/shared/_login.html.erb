<% jammit_css :login %>
<% @body_classes << "modal" if @body_classes %>
<% hide_self_reg_banner ||= false %>
<% extend Api::V1::Account %>
<% js_bundle :login %>
<% login_handle_name = @domain_root_account.login_handle_name rescue AccountAuthorizationConfig.default_login_handle_name %>
<div id="login" style="display:none;">
  <div id="modal-box-inner">
    <!--<% unless @domain_root_account.account_header.nil?  %>-->
    <!--style="background-image: url(<%="#{request.protocol}#{request.host}:#{request.port}#{header_logo_image}"%>)"-->
    <!--<% end  %>-->

    <% if @is_delegated %>
        <div id="login_form">
          <% if flash[:delegated_message] %>
              <div class="error_box errorBox" style="display: block; position:relative; top: auto; left: auto; max-width: 400px">
                <div class="error_text"><%= flash[:delegated_message] %></div>
              </div>
          <% end %>
          <%
             login_message = t('default_login_message', "Log in at your institution")
             if @domain_root_account && @domain_root_account.display_name
               login_message = t('login_at_account', "Log in at %{school_name}", :school_name => @domain_root_account.display_name)
             end
          %>
          <a href="<%= login_path %>" style="font-size: 1.3em;" class="btn"><%= login_message %></a>
        </div>
    <% else %>
        <div id ="login_modal">
          <div id="only_login">
            <%= form_for :pseudonym_session, :url => login_path(:nonldap => (@domain_root_account && !@domain_root_account.ldap_authentication?).presence), :html => {:id => "e_learning_login_form"} do |f| %>
                <form role="form" >
                  <%  if @domain_root_account.facebook_login? ||  @domain_root_account.google_login? ||  @domain_root_account.linkedin_login? %>
                      <table style="margin-top: 7px;">
                  <% else %>
                      <table style="margin-top: 20px;width:58px;margin-left: 75px">
                  <% end %>
                  <tbody><tr>
                    <td style=" width: 58%; padding: 10px; ">

                      <div class="form-group" style=" margin-top: 40px; margin-left: 33px; ">
                        <%=f.label :unique_id, login_handle_name %><%=f.text_field :unique_id, :class => "text", :value => params[:pseudonym_session].try(:[], :unique_id) %>
                      </div>
                      <div class="form-group" style=" margin-left: 33px; " >
                        <%= f.label :password,  "Password" %> <%=f.password_field :password, :class => "text" %>
                      </div>
                      <button type="submit" style="margin-left: 33px;" id="elearning_login_button" class="btn btn btn-primary">
                        Log In
                      </button>
            <% end %>
            <div style="margin-left: 34px;" class="top"><a id="forgot_passowrd_link" href="#">Forgot password?</a></div>
            <br>
            </td>
            <% if @domain_root_account.facebook_login? ||  @domain_root_account.google_login? ||  @domain_root_account.linkedin_login? %>
                <td style="width:13%;background-repeat:no-repeat;background-image:url('/images/verticle_line.jpg');background-position: 25px 20px;background-size: 2px 85%;">
                  <div> <%= image_tag("or.png", :size => "50x50", :alt => "") %> </div>
                </td>
                <td style=" width: 20%;display: table-cell;vertical-align: middle;min-height: 181px; ">
                  <div style="display: table-cell;vertical-align: middle;min-height: 181px;text-align: center;">
                    <div class="social_login" style="display: table-cell;vertical-align: middle;min-height: 181px;padding-top: 4px;">
            <% end %>
            <% if @domain_root_account.facebook_login? %>
                <%=  link_to image_tag("fbook.png",:class => "login_img", alt: ""), '/auth/facebook/' %>
                <br>
                FaceBook
                <br>

            <% end %>
            <% if @domain_root_account.google_login? %>
                <%= link_to image_tag("google.jpg", :class => "login_img", alt: ""), '/auth/google_oauth2/' %>
                <br>
                Google
                <br>
            <%end %>
            <% if @domain_root_account.linkedin_login? %>
                <%= link_to image_tag("linked_in.png", :class => "login_img", alt: ""), '/auth/linkedin/' %>
                LinkedIn
                <br>
            <%end %>
            </div>
            </div>
            </td>
            </tr>
            </tbody></table>

            </form>
            </div>
          </div>
          <!--forgot password form-->
          <%= form_for :pseudonym_session, :url => forgot_password_path, :html => {:id => "forgot_password_form", :style => "display: none;"} do |f| %>

              <p><%= t('login_handle', "Enter your %{login_handle_name} and we'll send you a link to change your password.", :login_handle_name => login_handle_name) %></p>
              <div>
                <span class="field-with-fancyplaceholder"><label  for="pseudonym_session_unique_id_forgot"><%= login_handle_name %></label><input class="email_address text" type="text" name="pseudonym_session[unique_id_forgot]" value="<%= @unauthorized_user.email rescue '' %>" id="pseudonym_session_unique_id_forgot" /></span>
                <button type="submit" id="request_password_button" class="btn btn-primary"><%= t('buttons.request_password', 'Request Password') %></button>
              </div>

              <div class="top"> &larr;<a id="login_link" href="#">Back to Login</a></div>
          <% end %>

        </div>
     <% end %>
  </div>

<%= # for plugin use
    render "shared/login_trailer" %>
<% js_block do %>
    <script type="text/javascript">
        require([
            'i18n!accounts' /* I18n.t */,
            'jquery' /* $ */,
            'compiled/util/addPrivacyLinkToDialog',
            'user_sortable_name',
            'jquery.instructure_forms' /* formSubmit */,
            'jqueryui/dialog',
            'compiled/jquery/fixDialogButtons' /* fix dialog formatting */,
            'compiled/jquery.rails_flash_notifications'
        ], function(I18n, $, addPrivacyLinkToDialog) {
            $(document).ready(function(){
                $("#login").dialog({
                    title: I18n.t('E-learning_login_pop_up', "Log In"),
                    width: 510,
                    poition: 'center'
                });
                $("#forgot_passowrd_link").click(function(){
                  $("#login_modal").hide();
                  $("#forgot_password_form").show();
                });
                $("#login_link").click(function(){
                  $("#forgot_password_form").hide();
                  $("#login_modal").show();
                });
            });
        });
        </script>
<%end%>