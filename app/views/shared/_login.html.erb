<% jammit_css :login_box%>
<% @body_classes << "modal" if @body_classes %>
<% hide_fft ||= false %>
<% js_block do %>
<script>
require([
  'i18nObj' /* I18n.t */,
  'jquery' /* $ */,
  'str/htmlEscape',
  'jquery.fancyplaceholder' /* fancyPlaceholder */,
  'jquery.google-analytics' /* trackPage, trackPageview */,
  'jquery.instructure_forms' /* formSubmit, getFormData, formErrors, errorBox */,
  'jquery.loadingImg' /* loadingImage */,
  'compiled/jquery.rails_flash_notifications',
], function(I18n, $, htmlEscape) {

$(document).ready(function() {
  $("#register_link").click(function(){
    $.trackPageview("/clicked_register_on_login_form");
  });

  $(".field-with-fancyplaceholder input").fancyPlaceholder();
  $("#forgot_password_form").formSubmit({
    object_name: 'pseudonym_session',
    required: ['unique_id_forgot'],
    beforeSubmit: function(data) {
      $(this).loadingImage();
    },
    success: function(data) {
      $(this).loadingImage('remove');
      $.flashMessage(htmlEscape(<%= jt("#pseudonyms.login.password_confirmation_sent", "Password confirmation sent to %{email_address}. Make sure you check your spam box.", '{email_address: $(this).find(".email_address").val()}') %>));
      $(".login_link:first").click();
    },
    error: function(data) {
      $(this).loadingImage('remove');
    }
  });
  $(".forgot_password_link").click(function(event) {
    event.preventDefault();
    $("#login_form").hide();
    $("#forgot_password_form").show();
  });
  $(".login_link").click(function(event) {
    event.preventDefault();
    $("#login_form").show();
    $("#forgot_password_form").hide();
  });

  $("#login_form")
    .submit(function(event) {
      var data = $(this).getFormData({object_name: 'pseudonym_session'});
      var success = true;
      if(!data.unique_id || data.unique_id.length < 1) {
        $(this).formErrors({
          unique_id: <%= jt("#pseudonyms.login.invalid_login", 'Invalid login') %>
        });
        success = false;
      } else if(!data.password || data.password.length < 1) {
        $(this).formErrors({
          password: <%= jt("#pseudonyms.login.invalid_password", 'Invalid password') %>
        });
        success = false;
      }
      return success;
    })
    .find(":text:first")
      .focus().select();
});
});
</script>
<% end %>
<% login_handle_name = @domain_root_account.login_handle_name rescue AccountAuthorizationConfig.default_login_handle_name %>

<h4 style="text-align: center;"><%=image_tag 'jigsaw_logo.png', :style => "width:300px;height:107px;margin-left: 9%;"%>
  <% if request.request_uri == "/login?lms_login=1" %>
      <a href="/"><button class="btn" style="float: right; padding: 10px;background: #f68121;margin: 30px 0px; color: #fff; border-radius: 7px;border: none;text-shadow: 0 0px 0px rgba(255, 255, 255, 0.75)">General Login</button></a>
      <% else  %>
    <a href="/login?lms_login=1"><button class="btn" style="float: right; padding: 10px;background: #f68121;margin: 30px 0px; color: #fff; border-radius: 7px;border: none;text-shadow: 0 0px 0px rgba(255, 255, 255, 0.75)">Corporate Login</button></a>
  <% end%>
</h4>
<div id="login_box" class="login-box">
    <div id="modal-box-inner" style="margin-top: 0px;">
    <h1 class="login_box_h1"></h1>
    <% if @is_delegated %>
      <div id="login_form">
        <% if flash[:delegated_message] %>
          <div class="error_box errorBox" style="display: block; position:relative; top: auto; left: auto; max-width: 400px">
            <div class="error_text"><%= flash[:delegated_message] %></div>
          </div>
        <% end %>
        <%
           login_message = t('default_login_message', "Log in at your institution")
           if @domain_root_account && @domain_root_account.display_name
             login_message = t('login_at_account', "Log in at %{school_name}", :school_name => @domain_root_account.display_name)
           end
        %>
        <a href="<%= login_path %>" style="font-size: 1.3em;" class="btn"><%= login_message %></a>
      </div>
    <% elsif request.request_uri == "/login?lms_login=1" %>

      <% form_for :pseudonym_session, :url => login_path(:nonldap => (@domain_root_account && !@domain_root_account.ldap_authentication?).presence), :html => {:id => "login_form"} do |f| %>
     <!--   <%= link_to t("register_for_canvas", "*Need a Jigsaw LMS Account?* **Click Here, It's Free!**", :wrapper => {'*' => '<i>\1</i>', '**' => '<b>\1</b>'}),  Setting.get_cached("registration_link", "/register_from_website"), :id => 'register_link', :class => 'not_external' if @domain_root_account.self_registration? && !hide_fft %> -->
              <div style="text-align: center;color:#000000;width: 360px;"> <h3>Sign in to Jigsaw LMS using email & password registered with us.</h3> </div>
        <h2 class="ui-helper-hidden-accessible"><%= t('log_in', 'Log In') %></h2>
        <% login_inner_dialog = yield :login_inner_dialog %>
        <%= login_inner_dialog if login_inner_dialog && !login_inner_dialog.strip.empty? %>
        <input type="hidden" name="redirect_to_ssl" value="1"/>
        <div style="margin-left: 50px;">
          <span class=" field-with-fancyplaceholder"><%= f.label :unique_id, login_handle_name %><%= f.text_field :unique_id, :class => "text", :value => params[:pseudonym_session].try(:[], :unique_id) %></span><br>
          <span class=" field-with-fancyplaceholder"><%= f.label :password, :en => "Password" %><%= f.password_field :password, :class => "text" %></span>
          <div class="login-options">
            <% unless session_timeout_enabled %>
                <%= f.check_box :remember_me, :checked => session[:used_remember_me_token] %>
                <%= f.label :remember_me, :en => "Remember" %>
            <% end %>

            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <% url = (params[:lms_login] != '1' && @domain_root_account.try(:forgot_password_external_url)) || "#" %>
            <%= link_to t('dont_know_password', "Forgot password?"), url, :class => (url != '#' ? "not_external" : "forgot_password_link"), :id => "login_forgot_password" %><br>
            <!-- crazy IE 8-9 workaround!, if you take this input type=submit out, you cannot just submit the form by hitting enter in ie8-9 -->
            <input type="submit" style="position: absolute; height: 0px; width: 0px; border: none; padding: 0px;" hidefocus="true" tabindex="-1" />

            <button type="submit" class="btn btn-primary"><%= t('log_in', 'Log in now!') %></button>
          </div>
         </div>
              <div >
                <%=image_tag 'login_or.png', :style => "margin:15px 0px;" %>
              </div>

              <div style="text-align: center;color:#000000;width: 360px;"> <h3 style="margin: 0px 55px;">Do you want to login using your social media IDs? please <a href="/" style="text-decoration: underline;color:#000000;"> click here</a>.</h3> </div>


      <% end %>
    <% else  %>
          <div style="text-align: center;color:#000000"> <h3>Connect any of your social profile with Jigsaw LMS for easy signing in.</h3> </div>
          <div style="text-align: center;">
          <ul style="margin: 0px;">
            <li style="line-height: 65px;"><%= link_to image_tag("Facebook_light.png",:class => "login_img", alt: "Login with FB"), '/auth/facebook/' %></li>
            <li style="line-height: 65px;"><%= link_to image_tag("Googleplus_light.png", :class => "login_img", alt: "Login with Goole"), '/auth/google_oauth2/' %></li>
            <li style="line-height: 65px;"> <%= link_to image_tag("Linkedin_light.png", :class => "login_img", alt: "Login with Linkedin"), '/auth/linkedin/' %></li>
          </ul>
          <!--<span> <%#= link_to image_tag("yahoo_icon.png", :class => "login_img", alt: "Login with Yahoo",:width =>"80px"), '/auth/yahoo/' %></span>&nbsp;&nbsp;&nbsp;-->
          <!--<span> <%#= link_to image_tag("windows_live.png", :class => "login_img", alt: "Login with Windows Live",:width =>"80px"), '/auth/windowslive/' %></span>&nbsp;&nbsp;&nbsp;-->
          </div>
    <% end %>

    <% form_for :pseudonym_session, :url => forgot_password_path, :html => {:id => "forgot_password_form", :style => "display: none;"} do |f| %>
          <div style="margin-left: 50px;">

            <div style="color:#000000;width: 260px;"> <h3 style="margin: 20px 0px;"><%= t('login_handle', "Enter your %{login_handle_name} and we'll send you a link to change your password.", :login_handle_name => login_handle_name) %></h3></div>
      <div>
        <span class=" field-with-fancyplaceholder"><label for="pseudonym_session_unique_id_forgot"><%= login_handle_name %></label><input class="email_address text" type="text" name="pseudonym_session[unique_id_forgot]" value="<%= @unauthorized_user.email rescue '' %>" id="pseudonym_session_unique_id_forgot" /></span>
        <button type="submit" class="btn btn-primary"><%= t('buttons.request_password', 'Request Password') %></button>
      </div>

      &larr; <%= link_to t('back_to_login', "Back to Login"), login_path, :class => "login_link" %>
          </div>
    <% end %>
  </div>
</div>



<%= # for plugin use
  render "shared/login_trailer" %>
