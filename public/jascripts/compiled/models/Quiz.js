// Generated by CoffeeScript 1.3.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['jquery', 'Backbone', 'compiled/models/Assignment', 'compiled/collections/AssignmentOverrideCollection', 'str/pluralize', 'i18n!quizzes', 'jquery.ajaxJSON', 'jquery.instructure_misc_helpers'], function($, Backbone, Assignment, AssignmentOverrideCollection, pluralize, I18n) {
    var Quiz;
    return Quiz = (function(_super) {

      __extends(Quiz, _super);

      function Quiz() {
        this.unpublish = __bind(this.unpublish, this);

        this.publish = __bind(this.publish, this);
        return Quiz.__super__.constructor.apply(this, arguments);
      }

      Quiz.prototype.resourceName = 'quizzes';

      Quiz.prototype.defaults = {
        due_at: null,
        unlock_at: null,
        lock_at: null,
        publishable: true,
        points_possible: null
      };

      Quiz.prototype.initialize = function(attributes, options) {
        if (options == null) {
          options = {};
        }
        Quiz.__super__.initialize.apply(this, arguments);
        this.initAssignment();
        this.initAssignmentOverrides();
        this.initUrls();
        this.initTitleLabel();
        this.initPublishable();
        this.initQuestionsCount();
        return this.initPointsCount();
      };

      Quiz.prototype.initAssignment = function() {
        if (this.attributes.assignment) {
          return this.set('assignment', new Assignment(this.attributes.assignment));
        }
      };

      Quiz.prototype.initAssignmentOverrides = function() {
        var overrides;
        if (this.attributes.assignment_overrides) {
          overrides = new AssignmentOverrideCollection(this.attributes.assignment_overrides);
          return this.set('assignment_overrides', overrides, {
            silent: true
          });
        }
      };

      Quiz.prototype.initUrls = function() {
        if (this.get('html_url')) {
          this.set('base_url', this.get('html_url').replace(/quizzes\/\d+/, "quizzes"));
          this.set('url', "" + (this.get('base_url')) + "/" + (this.get('id')));
          this.set('edit_url', "" + (this.get('base_url')) + "/" + (this.get('id')) + "/edit");
          this.set('publish_url', "" + (this.get('base_url')) + "/publish");
          return this.set('unpublish_url', "" + (this.get('base_url')) + "/unpublish");
        }
      };

      Quiz.prototype.initTitleLabel = function() {
        return this.set('title_label', this.get('title') || this.get('readable_type'));
      };

      Quiz.prototype.initPublishable = function() {
        if (this.get('can_unpublish') === false && this.get('published')) {
          return this.set('publishable', false);
        }
      };

      Quiz.prototype.initQuestionsCount = function() {
        var cnt;
        cnt = this.get('question_count');
        return this.set('question_count_label', I18n.t('question_count', 'Question', {
          count: cnt
        }));
      };

      Quiz.prototype.initPointsCount = function() {
        var pts, text;
        pts = this.get('points_possible');
        text = '';
        if (pts !== null) {
          text = I18n.t('assignment_points_possible', 'pt', {
            count: pts
          });
        }
        return this.set('possible_points_label', text);
      };

      Quiz.prototype.publish = function() {
        if (this.get('publishable')) {
          this.set('published', true);
          return $.ajaxJSON(this.get('publish_url'), 'POST', {
            'quizzes': [this.get('id')]
          });
        }
      };

      Quiz.prototype.unpublish = function() {
        this.set('published', false);
        return $.ajaxJSON(this.get('unpublish_url'), 'POST', {
          'quizzes': [this.get('id')]
        });
      };

      Quiz.prototype.disabledMessage = function() {
        return I18n.t('cant_unpublish_when_students_submit', "Can't unpublish if there are student submissions");
      };

      return Quiz;

    })(Backbone.Model);
  });

}).call(this);
