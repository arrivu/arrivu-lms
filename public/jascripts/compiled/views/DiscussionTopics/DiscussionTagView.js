// Generated by CoffeeScript 1.3.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['i18n!discussions', 'underscore', 'Backbone', 'jst/DiscussionTopics/tag', 'compiled/views/PublishIconView', 'compiled/views/ToggleableSubscriptionIconView'], function(I18n, _, _arg, template, PublishIconView, ToggleableSubscriptionIconView) {
    var DiscussionTagView, View;
    View = _arg.View;
    return DiscussionTagView = (function(_super) {

      __extends(DiscussionTagView, _super);

      function DiscussionTagView() {
        this.hide = __bind(this.hide, this);

        this.togglePinned = __bind(this.togglePinned, this);

        this.onDelete = __bind(this.onDelete, this);

        this.toggleLocked = __bind(this.toggleLocked, this);
        return DiscussionTagView.__super__.constructor.apply(this, arguments);
      }

      DiscussionTagView.prototype.template = template;

      DiscussionTagView.prototype.tagName = 'li';

      DiscussionTagView.prototype.className = 'token-input-token';

      DiscussionTagView.prototype.messages = {
        confirm: I18n.t('confirm_delete_discussion_topic', 'Are you sure you want to delete this discussion topic?'),
        "delete": I18n.t('delete', 'Delete'),
        lock: I18n.t('lock', 'Lock'),
        unlock: I18n.t('unlock', 'Unlock'),
        pin: I18n.t('pin', 'Pin'),
        unpin: I18n.t('unpin', 'Unpin'),
        user_subscribed: I18n.t('subscribed_hint', 'You are subscribed to this topic. Click to unsubscribe.'),
        user_unsubscribed: I18n.t('unsubscribed_hint', 'You are not subscribed to this topic. Click to subscribe.')
      };

      DiscussionTagView.prototype.events = {
        'click': 'onClick'
      };

      DiscussionTagView.prototype.defaults = {
        pinnable: false,
        tagTestMessage: "listing tag message"
      };

      DiscussionTagView.prototype.els = {
        '.screenreader-only': '$title'
      };

      DiscussionTagView.optionProperty('lockable');

      DiscussionTagView.optionProperty('pinnable');

      DiscussionTagView.child('toggleableSubscriptionIcon', '[data-view=toggleableSubscriptionIcon]');

      DiscussionTagView.prototype.render = function() {
        DiscussionTagView.__super__.render.apply(this, arguments);
        this.$el.html(this.template({
          entry: this.model
        }));
        return this;
      };

      DiscussionTagView.prototype.toggleLocked = function(e) {
        var key, locked, pinned;
        e.preventDefault();
        key = this.model.get('locked') ? 'lock' : 'unlock';
        locked = !this.model.get('locked');
        pinned = locked ? false : this.model.get('pinned');
        this.model.save({
          locked: locked,
          pinned: pinned
        });
        return $(e.target).text(this.messages[key]);
      };

      DiscussionTagView.prototype.onDelete = function(e) {
        e.preventDefault();
        if (confirm(this.messages.confirm)) {
          return this["delete"]();
        }
      };

      DiscussionTagView.prototype["delete"] = function() {
        this.model.destroy();
        return this.$el.remove();
      };

      DiscussionTagView.prototype.togglePinned = function(e) {
        var key;
        e.preventDefault();
        key = this.model.get('pinned') ? 'pin' : 'unpin';
        this.model.updateOneAttribute('pinned', !this.model.get('pinned'));
        return $(e.target).text(this.messages[key]);
      };

      DiscussionTagView.prototype.onClick = function(e) {
        return alert("" + e);
      };

      DiscussionTagView.prototype.hide = function() {
        return this.$el.toggle(!this.model.get('hidden'));
      };

      DiscussionTagView.prototype.toJSON = function() {
        var base;
        base = _.extend(this.model.toJSON(), this.options);
        if (this.model.get('locked') && !_.intersection(ENV.current_user_roles, ['teacher', 'ta', 'admin']).length) {
          base.permissions["delete"] = false;
        }
        return base;
      };

      DiscussionTagView.prototype.attachModel = function() {
        return this.model.on('change:hidden', this.hide);
      };

      return DiscussionTagView;

    })(View);
  });

}).call(this);
