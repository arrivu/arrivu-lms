// Generated by CoffeeScript 1.3.3
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['underscore', 'Backbone', 'jst/DiscussionTopics/discussionTagList', 'compiled/views/DiscussionTopics/DiscussionTagView', 'jqueryui/draggable', 'jqueryui/sortable'], function(_, Backbone, template, itemView) {
    var DiscussionTagListView;
    return DiscussionTagListView = (function(_super) {

      __extends(DiscussionTagListView, _super);

      function DiscussionTagListView() {
        this._onDrop = __bind(this._onDrop, this);

        this._updateSort = __bind(this._updateSort, this);

        this._onFetchedLast = __bind(this._onFetchedLast, this);

        this._toggleNoContentMessage = __bind(this._toggleNoContentMessage, this);

        this.renderItem = __bind(this.renderItem, this);
        return DiscussionTagListView.__super__.constructor.apply(this, arguments);
      }

      DiscussionTagListView.prototype.template = template;

      DiscussionTagListView.prototype.defaults = {
        showSpinner: true,
        showMessage: false,
        sortable: false
      };

      DiscussionTagListView.optionProperty('showSpinner');

      DiscussionTagListView.optionProperty('showMessage');

      DiscussionTagListView.optionProperty('title');

      DiscussionTagListView.optionProperty('listId');

      DiscussionTagListView.optionProperty('sortable');

      DiscussionTagListView.optionProperty('draggable');

      DiscussionTagListView.optionProperty('destination');

      DiscussionTagListView.prototype.spinnerOptions = {
        color: '#333',
        length: 5,
        radius: 6,
        width: 2
      };

      DiscussionTagListView.prototype.sortOptions = {
        tolerance: 'pointer'
      };

      DiscussionTagListView.prototype.dragOptions = {
        helper: 'clone',
        opacity: 0.75,
        revert: 'invalid',
        revertDuration: 0,
        zIndex: 100
      };

      DiscussionTagListView.prototype.dropOptions = {
        activeClass: 'droppable',
        hoverClass: 'droppable-hover',
        tolerance: 'pointer'
      };

      DiscussionTagListView.prototype.events = {
        'click .al-trigger': 'onAdminClick'
      };

      DiscussionTagListView.prototype.render = function() {
        DiscussionTagListView.__super__.render.apply(this, arguments);
        this._cacheElements();
        this._toggleNoContentMessage();
        this.$el.data('view', this);
        return this;
      };

      DiscussionTagListView.prototype.renderItem = function(model) {
        return DiscussionTagListView.__super__.renderItem.apply(this, arguments);
      };

      DiscussionTagListView.prototype.isEmpty = function() {
        return this.collection.isEmpty() || this.collection.all(function(m) {
          return m.get('hidden');
        });
      };

      DiscussionTagListView.prototype.toJSON = function() {
        return this.options;
      };

      DiscussionTagListView.prototype.onAdminClick = function(e) {
        return e.preventDefault();
      };

      DiscussionTagListView.prototype._startLoader = function() {
        var spinner;
        spinner = new Spinner(this.spinnerOptions);
        return spinner.spin(this.$loader.show()[0]);
      };

      DiscussionTagListView.prototype._stopLoader = function() {
        return this.$loader.empty().hide();
      };

      DiscussionTagListView.prototype._cacheElements = function() {
        this.$loader = this.$el.find('.loader');
        return this.$noContent = this.$el.find('.no-content');
      };

      DiscussionTagListView.prototype._toggleNoContentMessage = function() {
        if (this.options.showMessage) {
          return this.$noContent.toggle(this.isEmpty());
        }
      };

      DiscussionTagListView.prototype._onFetchedLast = function() {
        this.options.showSpinner = false;
        this.options.showMessage = true;
        this._stopLoader();
        this._toggleNoContentMessage();
        return this.collection.reset(this.collection.models);
      };

      DiscussionTagListView.prototype._updateSort = function(e, ui) {
        var model,
          _this = this;
        model = this.collection.get(ui.item.data('id'));
        if (!(model != null ? model.get('pinned') : void 0)) {
          return;
        }
        model.updateOneAttribute('position_at', ui.item.index() + 1);
        this._updatePositions();
        model.set('preventClick', true);
        return setTimeout(function() {
          return model.set('preventClick', false);
        }, 0);
      };

      DiscussionTagListView.prototype._updatePositions = function() {
        return this.collection.each(function(model, index) {
          return model.set('position', index + 1);
        });
      };

      DiscussionTagListView.prototype._onDrop = function(e, ui) {
        var currentGroup, locked, model, newGroup, pinned, _ref;
        model = this.collection.get(ui.draggable.data('id'));
        if (!model) {
          return;
        }
        _ref = [$(e.currentTarget).data('view'), this], newGroup = _ref[0], currentGroup = _ref[1];
        pinned = !!newGroup.options.pinned;
        locked = !!newGroup.options.locked;
        return model.save({
          pinned: pinned,
          locked: locked
        });
      };

      return DiscussionTagListView;

    })(Backbone.View);
  });

}).call(this);
