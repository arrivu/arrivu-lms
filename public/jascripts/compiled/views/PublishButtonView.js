// Generated by CoffeeScript 1.3.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  define(['i18n!publish_btn_module', 'jquery', 'compiled/fn/preventDefault', 'Backbone'], function(I18n, $, preventDefault, Backbone) {
    var PublishButton;
    return PublishButton = (function(_super) {

      __extends(PublishButton, _super);

      function PublishButton() {
        return PublishButton.__super__.constructor.apply(this, arguments);
      }

      PublishButton.prototype.disabledClass = 'disabled';

      PublishButton.prototype.publishClass = 'btn-publish';

      PublishButton.prototype.publishedClass = 'btn-published';

      PublishButton.prototype.unpublishClass = 'btn-unpublish';

      PublishButton.prototype.tagName = 'button';

      PublishButton.prototype.className = 'btn';

      PublishButton.prototype.events = {
        'click': 'click',
        'hover': 'hover'
      };

      PublishButton.prototype.els = {
        'i': '$icon',
        '.publish-text': '$text',
        '.desc': '$desc'
      };

      PublishButton.prototype.initialize = function() {
        var _ref,
          _this = this;
        PublishButton.__super__.initialize.apply(this, arguments);
        return (_ref = this.model) != null ? _ref.on('change:publishable', function() {
          if (!_this.model.get('publishable')) {
            return _this.disable();
          }
        }) : void 0;
      };

      PublishButton.prototype.setElement = function() {
        PublishButton.__super__.setElement.apply(this, arguments);
        if (!this.model.get('publishable')) {
          return this.disable();
        }
      };

      PublishButton.prototype.hover = function(_arg) {
        var type;
        type = _arg.type;
        if (type === 'mouseenter') {
          if (this.keepState || this.isPublish() || this.isDisabled()) {
            return;
          }
          this.renderUnpublish();
          return this.keepState = true;
        } else {
          this.keepState = false;
          if (!(this.isPublish() || this.isDisabled())) {
            return this.renderPublished();
          }
        }
      };

      PublishButton.prototype.click = function(event) {
        event.preventDefault();
        if (this.isDisabled()) {
          return;
        }
        this.keepState = true;
        if (this.isPublish()) {
          return this.publish();
        } else if (this.isUnpublish() || this.isPublished()) {
          return this.unpublish();
        }
      };

      PublishButton.prototype.publish = function(event) {
        var _this = this;
        this.renderPublishing();
        return this.model.publish().always(function() {
          _this.trigger("publish");
          _this.enable();
          return _this.render();
        });
      };

      PublishButton.prototype.unpublish = function(event) {
        var _this = this;
        this.renderUnpublishing();
        return this.model.unpublish().always(function() {
          _this.trigger("unpublish");
          _this.enable();
          return _this.render();
        });
      };

      PublishButton.prototype.isPublish = function() {
        return this.$el.hasClass(this.publishClass);
      };

      PublishButton.prototype.isPublished = function() {
        return this.$el.hasClass(this.publishedClass);
      };

      PublishButton.prototype.isUnpublish = function() {
        return this.$el.hasClass(this.unpublishClass);
      };

      PublishButton.prototype.isDisabled = function() {
        return this.$el.hasClass(this.disabledClass);
      };

      PublishButton.prototype.disable = function() {
        return this.$el.addClass(this.disabledClass);
      };

      PublishButton.prototype.enable = function() {
        return this.$el.removeClass(this.disabledClass);
      };

      PublishButton.prototype.reset = function() {
        this.$el.removeClass("" + this.publishClass + " " + this.publishedClass + " " + this.unpublishClass);
        return this.$icon.removeClass('icon-publish icon-unpublish icon-unpublished');
      };

      PublishButton.prototype.render = function() {
        this.$el.attr('role', 'button');
        this.$el.html('<i></i><span class="publish-text"></span><span class="desc"></span>');
        this.cacheEls();
        this.$text.attr('role', 'presentation');
        this.$text.attr('tabindex', '-1');
        if (this.model.get('published')) {
          this.renderPublished();
        } else {
          this.renderPublish();
        }
        return this;
      };

      PublishButton.prototype.renderPublish = function() {
        return this.renderState({
          text: I18n.t('buttons.publish', 'Publish'),
          description: I18n.t('buttons.publish_desc', 'Unpublished. Click to publish'),
          buttonClass: this.publishClass,
          iconClass: 'icon-unpublished'
        });
      };

      PublishButton.prototype.renderPublished = function() {
        return this.renderState({
          text: I18n.t('buttons.published', 'Published'),
          description: I18n.t('buttons.published_desc', 'Published. Click to unpublish'),
          buttonClass: this.publishedClass,
          iconClass: 'icon-publish'
        });
      };

      PublishButton.prototype.renderUnpublish = function() {
        var text;
        text = I18n.t('buttons.unpublish', 'Unpublish');
        return this.renderState({
          text: text,
          buttonClass: this.unpublishClass,
          iconClass: 'icon-unpublish'
        });
      };

      PublishButton.prototype.renderPublishing = function() {
        var text;
        this.disable();
        text = I18n.t('buttons.publishing', 'Publishing...');
        return this.renderState({
          text: text,
          buttonClass: this.publishClass,
          iconClass: 'icon-publish'
        });
      };

      PublishButton.prototype.renderUnpublishing = function() {
        var text;
        this.disable();
        text = I18n.t('buttons.unpublishing', 'Unpublishing...');
        return this.renderState({
          text: text,
          buttonClass: this.unpublishClass,
          iconClass: 'icon-unpublished'
        });
      };

      PublishButton.prototype.renderState = function(options) {
        var descId;
        this.reset();
        this.$el.addClass(options.buttonClass);
        this.$el.attr('aria-pressed', options.buttonClass === this.publishedClass);
        this.$icon.addClass(options.iconClass);
        this.$text.html("&nbsp;" + options.text);
        descId = "button-desc-" + this.model.id;
        this.$desc.attr('id', descId);
        this.$desc.addClass('screenreader-only');
        this.$el.attr('aria-describedby', descId);
        if (this.model.get('publishable')) {
          this.$el.attr('title', options.text);
          if (options.description) {
            return this.$desc.html(options.description);
          } else {
            return this.$el.removeAttr('aria-describedby');
          }
        } else {
          this.$el.attr('aria-disabled', true);
          this.$el.attr('title', this.model.disabledMessage());
          return this.$desc.html(this.model.disabledMessage());
        }
      };

      return PublishButton;

    })(Backbone.View);
  });

}).call(this);
